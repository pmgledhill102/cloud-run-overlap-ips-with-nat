<mxfile host="app.diagrams.net" modified="2026-02-25T09:00:00.000Z">
  <diagram name="Architecture" id="arch">
    <mxGraphModel dx="1422" dy="900" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="900" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- Title -->
        <mxCell id="title" value="Hub-Spoke Architecture — Overlapping IPs with Hybrid NAT" style="text;html=1;fontSize=18;fontStyle=1;align=center;fontColor=#202124;" vertex="1" parent="1">
          <mxGeometry x="250" y="10" width="1100" height="35" as="geometry"/>
        </mxCell>

        <!-- ==================== SPOKE-1 VPC ==================== -->
        <mxCell id="vpc-s1" value="spoke-1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F0FE;strokeColor=#4285F4;strokeWidth=2;verticalAlign=top;fontStyle=1;fontSize=16;fontColor=#1A73E8;arcSize=4;container=1;collapsible=0;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="40" y="70" width="420" height="620" as="geometry"/>
        </mxCell>

        <!-- Overlap subnet -->
        <mxCell id="sub-overlap-s1" value="overlap-spoke-1  —  240.0.0.0/8 (Class E, overlapping)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#DADCE0;strokeWidth=1;dashed=1;dashPattern=5 5;verticalAlign=top;fontSize=10;fontColor=#5F6368;fontStyle=1;arcSize=6;container=1;collapsible=0;spacingTop=2;" vertex="1" parent="vpc-s1">
          <mxGeometry x="15" y="38" width="390" height="145" as="geometry"/>
        </mxCell>
        <mxCell id="cr-s1" value="cr-spoke-1" style="shape=mxgraph.gcp2.cloud_run;fillColor=#AECBFA;strokeColor=none;verticalLabelPosition=bottom;verticalAlign=top;align=center;fontSize=10;fontColor=#3C4043;fontStyle=1;" vertex="1" parent="sub-overlap-s1">
          <mxGeometry x="48" y="42" width="68" height="53" as="geometry"/>
        </mxCell>
        <mxCell id="cr-s1-desc" value="Cloud Run service" style="text;fontSize=8;fontColor=#80868B;align=center;" vertex="1" parent="sub-overlap-s1">
          <mxGeometry x="32" y="110" width="100" height="14" as="geometry"/>
        </mxCell>
        <mxCell id="job-s1" value="job-spoke-1" style="shape=mxgraph.gcp2.cloud_run;fillColor=#C8E6C9;strokeColor=none;verticalLabelPosition=bottom;verticalAlign=top;align=center;fontSize=10;fontColor=#3C4043;fontStyle=1;" vertex="1" parent="sub-overlap-s1">
          <mxGeometry x="248" y="42" width="68" height="53" as="geometry"/>
        </mxCell>
        <mxCell id="job-s1-desc" value="Cloud Run job" style="text;fontSize=8;fontColor=#80868B;align=center;" vertex="1" parent="sub-overlap-s1">
          <mxGeometry x="237" y="110" width="90" height="14" as="geometry"/>
        </mxCell>

        <!-- Routable subnet + ILB -->
        <mxCell id="sub-routable-s1" value="routable-spoke-1  —  10.1.0.0/28" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#DADCE0;strokeWidth=1;dashed=1;dashPattern=5 5;verticalAlign=top;fontSize=10;fontColor=#5F6368;fontStyle=1;arcSize=6;container=1;collapsible=0;spacingTop=2;" vertex="1" parent="vpc-s1">
          <mxGeometry x="15" y="200" width="390" height="110" as="geometry"/>
        </mxCell>
        <mxCell id="ilb-s1" value="ilb-spoke-1" style="shape=mxgraph.gcp2.cloud_load_balancing;fillColor=#F8BBD0;strokeColor=none;verticalLabelPosition=bottom;verticalAlign=top;align=center;fontSize=10;fontColor=#3C4043;fontStyle=1;" vertex="1" parent="sub-routable-s1">
          <mxGeometry x="141" y="28" width="68" height="53" as="geometry"/>
        </mxCell>
        <mxCell id="ilb-s1-desc" value="Internal Load Balancer&#xa;HTTPS :443" style="text;fontSize=8;fontColor=#80868B;align=center;" vertex="1" parent="sub-routable-s1">
          <mxGeometry x="115" y="92" width="120" height="14" as="geometry"/>
        </mxCell>

        <!-- Supporting subnets -->
        <mxCell id="proxy-s1" value="proxy-spoke-1&#xa;241.0.0.0/26 (Class E)&#xa;ILB Envoy proxies" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F8F9FA;strokeColor=#DADCE0;fontSize=9;fontColor=#5F6368;arcSize=8;" vertex="1" parent="vpc-s1">
          <mxGeometry x="15" y="325" width="185" height="52" as="geometry"/>
        </mxCell>
        <mxCell id="pnat-s1" value="pnat-spoke-1&#xa;172.16.1.0/24&#xa;Hybrid NAT source IPs" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF8E1;strokeColor=#DADCE0;fontSize=9;fontColor=#5F6368;arcSize=8;" vertex="1" parent="vpc-s1">
          <mxGeometry x="220" y="325" width="185" height="52" as="geometry"/>
        </mxCell>

        <!-- Hybrid NAT -->
        <mxCell id="nat-s1" value="hybrid-nat-spoke-1" style="shape=mxgraph.gcp2.cloud_nat;fillColor=#FFE082;strokeColor=none;verticalLabelPosition=bottom;verticalAlign=top;align=center;fontSize=10;fontColor=#3C4043;fontStyle=1;" vertex="1" parent="vpc-s1">
          <mxGeometry x="73" y="400" width="68" height="53" as="geometry"/>
        </mxCell>
        <mxCell id="nat-s1-desc" value="Private NAT&#xa;nexthop.is_hybrid" style="text;fontSize=8;fontColor=#80868B;align=center;" vertex="1" parent="vpc-s1">
          <mxGeometry x="47" y="466" width="120" height="24" as="geometry"/>
        </mxCell>

        <!-- VPN Router -->
        <mxCell id="router-s1" value="vpn-router-spoke-1" style="shape=mxgraph.gcp2.cloud_router;fillColor=#B39DDB;strokeColor=none;verticalLabelPosition=bottom;verticalAlign=top;align=center;fontSize=10;fontColor=#3C4043;fontStyle=1;" vertex="1" parent="vpc-s1">
          <mxGeometry x="270" y="400" width="68" height="53" as="geometry"/>
        </mxCell>
        <mxCell id="router-s1-desc" value="ASN 65001" style="text;fontSize=8;fontColor=#80868B;align=center;" vertex="1" parent="vpc-s1">
          <mxGeometry x="274" y="466" width="60" height="14" as="geometry"/>
        </mxCell>

        <!-- VPN Gateway -->
        <mxCell id="vpngw-s1" value="vpn-gw-spoke-1" style="shape=mxgraph.gcp2.cloud_vpn;fillColor=#CE93D8;strokeColor=none;verticalLabelPosition=bottom;verticalAlign=top;align=center;fontSize=10;fontColor=#3C4043;fontStyle=1;" vertex="1" parent="vpc-s1">
          <mxGeometry x="176" y="530" width="68" height="53" as="geometry"/>
        </mxCell>

        <!-- ==================== HUB VPC ==================== -->
        <mxCell id="vpc-hub" value="hub" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F0FE;strokeColor=#4285F4;strokeWidth=2;verticalAlign=top;fontStyle=1;fontSize=16;fontColor=#1A73E8;arcSize=4;container=1;collapsible=0;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="560" y="70" width="280" height="620" as="geometry"/>
        </mxCell>

        <!-- Compute subnet -->
        <mxCell id="sub-compute" value="compute-hub  —  10.0.0.0/28" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#DADCE0;strokeWidth=1;dashed=1;dashPattern=5 5;verticalAlign=top;fontSize=10;fontColor=#5F6368;fontStyle=1;arcSize=6;container=1;collapsible=0;spacingTop=2;" vertex="1" parent="vpc-hub">
          <mxGeometry x="15" y="38" width="250" height="145" as="geometry"/>
        </mxCell>
        <mxCell id="vm-hub" value="vm-hub" style="shape=mxgraph.gcp2.compute_engine;fillColor=#AECBFA;strokeColor=none;verticalLabelPosition=bottom;verticalAlign=top;align=center;fontSize=10;fontColor=#3C4043;fontStyle=1;" vertex="1" parent="sub-compute">
          <mxGeometry x="91" y="35" width="68" height="53" as="geometry"/>
        </mxCell>
        <mxCell id="vm-hub-desc" value="e2-micro&#xa;python3 http.server :80" style="text;fontSize=8;fontColor=#80868B;align=center;" vertex="1" parent="sub-compute">
          <mxGeometry x="65" y="103" width="120" height="24" as="geometry"/>
        </mxCell>

        <!-- Public NAT -->
        <mxCell id="nat-hub" value="public-nat-hub" style="shape=mxgraph.gcp2.cloud_nat;fillColor=#FFE082;strokeColor=none;verticalLabelPosition=bottom;verticalAlign=top;align=center;fontSize=10;fontColor=#3C4043;fontStyle=1;" vertex="1" parent="vpc-hub">
          <mxGeometry x="106" y="220" width="68" height="53" as="geometry"/>
        </mxCell>
        <mxCell id="nat-hub-desc" value="Internet access for VM" style="text;fontSize=8;fontColor=#80868B;align=center;" vertex="1" parent="vpc-hub">
          <mxGeometry x="80" y="286" width="120" height="14" as="geometry"/>
        </mxCell>

        <!-- VPN Router -->
        <mxCell id="router-hub" value="vpn-router-hub" style="shape=mxgraph.gcp2.cloud_router;fillColor=#B39DDB;strokeColor=none;verticalLabelPosition=bottom;verticalAlign=top;align=center;fontSize=10;fontColor=#3C4043;fontStyle=1;" vertex="1" parent="vpc-hub">
          <mxGeometry x="106" y="340" width="68" height="53" as="geometry"/>
        </mxCell>
        <mxCell id="router-hub-desc" value="ASN 65000" style="text;fontSize=8;fontColor=#80868B;align=center;" vertex="1" parent="vpc-hub">
          <mxGeometry x="110" y="406" width="60" height="14" as="geometry"/>
        </mxCell>

        <!-- Hub VPN Gateways -->
        <mxCell id="vpngw-hub-s1" value="vpn-gw-hub&#xa;-to-spoke-1" style="shape=mxgraph.gcp2.cloud_vpn;fillColor=#CE93D8;strokeColor=none;verticalLabelPosition=bottom;verticalAlign=top;align=center;fontSize=9;fontColor=#3C4043;fontStyle=1;" vertex="1" parent="vpc-hub">
          <mxGeometry x="20" y="480" width="68" height="53" as="geometry"/>
        </mxCell>
        <mxCell id="vpngw-hub-s2" value="vpn-gw-hub&#xa;-to-spoke-2" style="shape=mxgraph.gcp2.cloud_vpn;fillColor=#CE93D8;strokeColor=none;verticalLabelPosition=bottom;verticalAlign=top;align=center;fontSize=9;fontColor=#3C4043;fontStyle=1;" vertex="1" parent="vpc-hub">
          <mxGeometry x="192" y="480" width="68" height="53" as="geometry"/>
        </mxCell>

        <!-- ==================== SPOKE-2 VPC ==================== -->
        <mxCell id="vpc-s2" value="spoke-2" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E8F0FE;strokeColor=#4285F4;strokeWidth=2;verticalAlign=top;fontStyle=1;fontSize=16;fontColor=#1A73E8;arcSize=4;container=1;collapsible=0;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="940" y="70" width="420" height="620" as="geometry"/>
        </mxCell>

        <!-- Overlap subnet -->
        <mxCell id="sub-overlap-s2" value="overlap-spoke-2  —  240.0.0.0/8 (Class E, overlapping)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#DADCE0;strokeWidth=1;dashed=1;dashPattern=5 5;verticalAlign=top;fontSize=10;fontColor=#5F6368;fontStyle=1;arcSize=6;container=1;collapsible=0;spacingTop=2;" vertex="1" parent="vpc-s2">
          <mxGeometry x="15" y="38" width="390" height="145" as="geometry"/>
        </mxCell>
        <mxCell id="cr-s2" value="cr-spoke-2" style="shape=mxgraph.gcp2.cloud_run;fillColor=#AECBFA;strokeColor=none;verticalLabelPosition=bottom;verticalAlign=top;align=center;fontSize=10;fontColor=#3C4043;fontStyle=1;" vertex="1" parent="sub-overlap-s2">
          <mxGeometry x="48" y="42" width="68" height="53" as="geometry"/>
        </mxCell>
        <mxCell id="cr-s2-desc" value="Cloud Run service" style="text;fontSize=8;fontColor=#80868B;align=center;" vertex="1" parent="sub-overlap-s2">
          <mxGeometry x="32" y="110" width="100" height="14" as="geometry"/>
        </mxCell>
        <mxCell id="job-s2" value="job-spoke-2" style="shape=mxgraph.gcp2.cloud_run;fillColor=#C8E6C9;strokeColor=none;verticalLabelPosition=bottom;verticalAlign=top;align=center;fontSize=10;fontColor=#3C4043;fontStyle=1;" vertex="1" parent="sub-overlap-s2">
          <mxGeometry x="248" y="42" width="68" height="53" as="geometry"/>
        </mxCell>
        <mxCell id="job-s2-desc" value="Cloud Run job" style="text;fontSize=8;fontColor=#80868B;align=center;" vertex="1" parent="sub-overlap-s2">
          <mxGeometry x="237" y="110" width="90" height="14" as="geometry"/>
        </mxCell>

        <!-- Routable subnet + ILB -->
        <mxCell id="sub-routable-s2" value="routable-spoke-2  —  10.2.0.0/28" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#DADCE0;strokeWidth=1;dashed=1;dashPattern=5 5;verticalAlign=top;fontSize=10;fontColor=#5F6368;fontStyle=1;arcSize=6;container=1;collapsible=0;spacingTop=2;" vertex="1" parent="vpc-s2">
          <mxGeometry x="15" y="200" width="390" height="110" as="geometry"/>
        </mxCell>
        <mxCell id="ilb-s2" value="ilb-spoke-2" style="shape=mxgraph.gcp2.cloud_load_balancing;fillColor=#F8BBD0;strokeColor=none;verticalLabelPosition=bottom;verticalAlign=top;align=center;fontSize=10;fontColor=#3C4043;fontStyle=1;" vertex="1" parent="sub-routable-s2">
          <mxGeometry x="141" y="28" width="68" height="53" as="geometry"/>
        </mxCell>
        <mxCell id="ilb-s2-desc" value="Internal Load Balancer&#xa;HTTPS :443" style="text;fontSize=8;fontColor=#80868B;align=center;" vertex="1" parent="sub-routable-s2">
          <mxGeometry x="115" y="92" width="120" height="14" as="geometry"/>
        </mxCell>

        <!-- Supporting subnets -->
        <mxCell id="proxy-s2" value="proxy-spoke-2&#xa;241.0.0.0/26 (Class E)&#xa;ILB Envoy proxies" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F8F9FA;strokeColor=#DADCE0;fontSize=9;fontColor=#5F6368;arcSize=8;" vertex="1" parent="vpc-s2">
          <mxGeometry x="15" y="325" width="185" height="52" as="geometry"/>
        </mxCell>
        <mxCell id="pnat-s2" value="pnat-spoke-2&#xa;172.16.2.0/24&#xa;Hybrid NAT source IPs" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF8E1;strokeColor=#DADCE0;fontSize=9;fontColor=#5F6368;arcSize=8;" vertex="1" parent="vpc-s2">
          <mxGeometry x="220" y="325" width="185" height="52" as="geometry"/>
        </mxCell>

        <!-- Hybrid NAT -->
        <mxCell id="nat-s2" value="hybrid-nat-spoke-2" style="shape=mxgraph.gcp2.cloud_nat;fillColor=#FFE082;strokeColor=none;verticalLabelPosition=bottom;verticalAlign=top;align=center;fontSize=10;fontColor=#3C4043;fontStyle=1;" vertex="1" parent="vpc-s2">
          <mxGeometry x="73" y="400" width="68" height="53" as="geometry"/>
        </mxCell>
        <mxCell id="nat-s2-desc" value="Private NAT&#xa;nexthop.is_hybrid" style="text;fontSize=8;fontColor=#80868B;align=center;" vertex="1" parent="vpc-s2">
          <mxGeometry x="47" y="466" width="120" height="24" as="geometry"/>
        </mxCell>

        <!-- VPN Router -->
        <mxCell id="router-s2" value="vpn-router-spoke-2" style="shape=mxgraph.gcp2.cloud_router;fillColor=#B39DDB;strokeColor=none;verticalLabelPosition=bottom;verticalAlign=top;align=center;fontSize=10;fontColor=#3C4043;fontStyle=1;" vertex="1" parent="vpc-s2">
          <mxGeometry x="270" y="400" width="68" height="53" as="geometry"/>
        </mxCell>
        <mxCell id="router-s2-desc" value="ASN 65002" style="text;fontSize=8;fontColor=#80868B;align=center;" vertex="1" parent="vpc-s2">
          <mxGeometry x="274" y="466" width="60" height="14" as="geometry"/>
        </mxCell>

        <!-- VPN Gateway -->
        <mxCell id="vpngw-s2" value="vpn-gw-spoke-2" style="shape=mxgraph.gcp2.cloud_vpn;fillColor=#CE93D8;strokeColor=none;verticalLabelPosition=bottom;verticalAlign=top;align=center;fontSize=10;fontColor=#3C4043;fontStyle=1;" vertex="1" parent="vpc-s2">
          <mxGeometry x="176" y="530" width="68" height="53" as="geometry"/>
        </mxCell>

        <!-- ==================== VPN CONNECTIONS ==================== -->
        <mxCell id="vpn-line-s1" value="" style="endArrow=none;startArrow=none;strokeColor=#7B1FA2;strokeWidth=4;html=1;" edge="1" parent="1" source="vpngw-hub-s1" target="vpngw-s1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="vpn-label-s1" value="HA VPN&#xa;4 tunnels" style="text;fontSize=10;fontColor=#7B1FA2;align=center;fontStyle=1;fillColor=#F3E5F5;rounded=1;strokeColor=#CE93D8;" vertex="1" parent="1">
          <mxGeometry x="370" y="762" width="80" height="32" as="geometry"/>
        </mxCell>

        <mxCell id="vpn-line-s2" value="" style="endArrow=none;startArrow=none;strokeColor=#7B1FA2;strokeWidth=4;html=1;" edge="1" parent="1" source="vpngw-hub-s2" target="vpngw-s2">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="vpn-label-s2" value="HA VPN&#xa;4 tunnels" style="text;fontSize=10;fontColor=#7B1FA2;align=center;fontStyle=1;fillColor=#F3E5F5;rounded=1;strokeColor=#CE93D8;" vertex="1" parent="1">
          <mxGeometry x="950" y="762" width="80" height="32" as="geometry"/>
        </mxCell>

        <!-- ==================== KEY FINDINGS ==================== -->
        <mxCell id="findings" value="Key Findings&#xa;&#xa;✓  Cloud Run services work on overlapping Class E (240.0.0.0/8) subnets across VPCs&#xa;✓  Hybrid NAT translates overlapping IPs to unique routable IPs for cross-VPC traffic&#xa;✓  ILB proxy-only subnets accept Class E (241.0.0.0/26) — can overlap across spokes" style="text;fontSize=10;fontColor=#3C4043;align=left;verticalAlign=top;fillColor=#FFF8E1;rounded=1;strokeColor=#F9A825;spacingLeft=10;spacingRight=10;spacingTop=6;spacingBottom=6;whiteSpace=wrap;" vertex="1" parent="1">
          <mxGeometry x="40" y="810" width="500" height="80" as="geometry"/>
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
